# Copyright (c) 2019 Michael Vilim
#
# This file is part of the taserver-linux library. It is currently hosted at
# https://github.com/mvilim/taserver-linux
#
# taserver-linux is licensed under the AGPL. A copy of the license can be
# found in the root folder of the project.

From 58a6bbab6c1d91fa991eee42c95ce91384a07bd3 Mon Sep 17 00:00:00 2001
From: Michael Vilim <michael.vilim@gmail.com>
Date: Thu, 14 Feb 2019 11:17:42 -0600
Subject: [PATCH 1/4] Add wine prefix to udpproxy

---
 firewall/main.py | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/firewall/main.py b/firewall/main.py
index 12c1b51..82ee435 100644
--- a/firewall/main.py
+++ b/firewall/main.py
@@ -25,6 +25,7 @@ import gevent.subprocess as sp
 import json
 import logging
 import sys
+import os
 
 from common.logging import set_up_logging
 from common.tcpmessage import TcpMessageReader
@@ -174,8 +175,10 @@ class Firewall:
 
 def main():
     try:
-        udp_proxy_proc1 = sp.Popen('udpproxy.exe %d' % GAME_PORT1)
-        udp_proxy_proc2 = sp.Popen('udpproxy.exe %d' % GAME_PORT2)
+        wine64env = os.environ.copy()
+        wine64env['WINEPREFIX'] = '/home/tribes/.wine64'
+        udp_proxy_proc1 = sp.Popen('udpproxy.exe %d' % GAME_PORT1, env=wine64env)
+        udp_proxy_proc2 = sp.Popen('udpproxy.exe %d' % GAME_PORT2, env=wine64env)
 
     except OSError as e:
         print('Failed to run udpproxy.exe. Run download_udpproxy.py to download it\n'
-- 
2.20.1

